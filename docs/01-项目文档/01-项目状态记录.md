# YouTube Planner 项目状态记录

## 📅 最后更新时间
2024年12月19日 - 18:30 (最新状态)

## 🎯 项目概述
YouTube视频脚本管理系统，包含前端(React)和后端(Spring Boot)，部署在AWS EC2上。

## 🌐 当前部署状态

### 域名和SSL
- **域名**: youtubeplanner.duckdns.org
- **DuckDNS Token**: 2a6b1938-8078-4553-a435-af0b72dfd3c6
- **SSL证书**: Let's Encrypt
- **证书有效期**: 89天
- **自动续期**: 已配置（每天中午12点检查）

### 服务器信息
- **云服务商**: AWS EC2
- **实例类型**: t2.micro (免费套餐)
- **公网IP**: 43.206.130.75
- **区域**: ap-northeast-1 (东京)
- **操作系统**: Amazon Linux 2

### 应用架构
```
用户 → HTTPS (443) → Nginx → 
├── 前端容器 (3000:80) - 暴露端口3000
└── 后端容器 (8080:8080) - 暴露端口8080 → PostgreSQL容器
```

## 🐳 Docker容器状态

### 当前运行的容器
1. **youtubeplanner-db-prod**: PostgreSQL 15数据库
2. **youtubeplanner-backend-prod**: Spring Boot应用
3. **youtubeplanner-frontend-prod**: React应用

### 容器配置
- **网络**: youtubeplanner-network (bridge)
- **数据持久化**: postgres_data volume
- **日志**: backend_logs volume

## 🔧 最新配置更新 (2024-12-19)

### 环境变量配置
```yaml
# 前端配置
REACT_APP_API_BASE_URL=https://youtubeplanner.duckdns.org/api/v1

# 后端配置
CORS_ALLOWED_ORIGINS=https://youtubeplanner.duckdns.org
```

### 安全改进
- ✅ 重新暴露容器端口以支持Nginx反向代理
- ✅ 所有流量通过Nginx反向代理
- ✅ 启用HTTPS加密
- ✅ 限制CORS只允许指定域名
- ✅ 修复502 Bad Gateway错误

## 📊 数据库配置

### PostgreSQL设置
- **版本**: PostgreSQL 15 Alpine
- **数据库名**: youtubeplanner
- **用户名**: youtubeplanner
- **密码**: youtubeplanner123
- **初始化脚本**: init-db.sql

### 数据表结构
- users: 用户表
- channels: 频道表
- categories: 分类表
- scripts: 脚本表
- chapters: 章节表

## 🚀 部署流程

### CI/CD配置
- **平台**: GitHub Actions
- **触发分支**: main, master, clean-deploy
- **部署方式**: Docker容器化部署
- **自动化程度**: 完全自动化

### 部署步骤
1. 代码推送到main或clean-deploy分支
2. GitHub Actions自动构建Docker镜像
3. 部署到EC2服务器
4. 健康检查确认服务状态

## 🔐 安全配置

### JWT配置
- **Secret**: 404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970
- **Access Token过期时间**: 3600秒 (1小时)
- **Refresh Token过期时间**: 604800秒 (7天)

### Nginx配置
- **HTTP自动重定向到HTTPS**
- **反向代理配置**:
  - `/` → 前端容器:80
  - `/api/` → 后端容器:8080
- **SSL证书路径**: /etc/letsencrypt/live/youtubeplanner.duckdns.org/

## 📝 待办事项

### 已完成 ✅
- [x] 确认新配置部署状态
- [x] 测试HTTPS域名访问
- [x] 验证API调用正常
- [x] 修复502 Bad Gateway错误
- [x] 合并分支到main
- [x] 重新暴露容器端口

### 未来优化
- [ ] 添加监控和日志分析
- [ ] 数据库备份策略
- [ ] 性能优化
- [ ] 错误处理改进

## 🐛 已知问题
目前无已知问题。

## ✅ 最近解决的问题
- **502 Bad Gateway错误** (2024-12-19): 通过重新暴露容器端口解决
- **分支管理混乱** (2024-12-19): 已将clean-deploy分支合并到main
- **文档结构混乱** (2024-12-19): 已重新整理文档结构

## 📞 联系信息
- **GitHub**: https://github.com/sanuei/YoutubePlanner
- **主要分支**: main (生产环境)
- **开发分支**: clean-deploy

## 📚 相关文档
- AWS-EC2-部署指南.md
- setup-domain.md
- api_doc_revised.md
- 免费套餐部署指南.md 